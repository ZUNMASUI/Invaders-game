<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>インベーダー</title>
</head>

<body>
  <canvas id="canvas" style="background-color: rgb(149, 154, 154)" width="800" height="500"></canvas>
  <script>
    "use strict";
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    


    const endImage = new Image();//ゲームオーバの情報を入れる変数
    endImage.src = "/Users/masuishintarou/Documents/GitHub/Invaders-game/gameover.jpeg";

    const clearImage = new Image();//ゲームクリアの情報を入れる変数
    clearImage.src = "/Users/masuishintarou/Documents/GitHub/Invaders-game/gameclear.png";

    const MUTEKI_INTERVAL = 5;//ダメージを受けた後の無敵時間


    //ゲーム全体をコントロールクラス  このクラスの役割　どのようなメソッドが必要　その役割を整理する　どんな順番で動かすのか
    class Game {
      constructor() {
        this.enemyCharacters = []; //生成された敵のインスタンスが入る配列
        this.bullets = []; //生成された攻撃の弾のインスタンスが入る配列

        // onkeydownプロパティにcharaクラスのinputメソッドを実行させる
        window.onkeydown = () => {
          this.chara.input(event)
        }
      }


      //初期化 まず初めに実行される 自機キャラと敵キャラを初期位置に配置する。
      initialize = () => {
        const Chara = new Character(400, 400, 30);
        this.chara = Chara
        for (let i = 0; i < 10; i++) {
          let x = Math.floor(Math.random() * 800);
          let y = Math.floor(Math.random() * 100);
          const eneChara = new Enemy(x, y);
          this.enemyCharacters.push(eneChara);
        }
      }


      //三平方の定理を使って、距離を判定するメソッド
      calcDistance = () => {
        return Math.sqrt(Math.pow(this.x - x, 2) + Math.pow(this.y - y, 2));
      }

      //マイフレーム実行するメソッド
      mainLoop = () => {

        // 描画を消す
        ctx.clearRect(0, 0, 800, 500);


        // 敵が動く
        this.enemyCharacters.forEach(enemy => {
          enemy.move();
        });

        //自機キャラが描かれる。初期位置
        ctx.drawImage(this.chara.image, this.chara.x, this.chara.y, 70, 70);

        //弾の配列にあるインスタンスそれぞれに弾クラスのmoveメソッドを実行し動きを描く
        this.bullets.forEach(bullet => {
          bullet.move();
        });
      }


      //指定したデータを描くメソッド
      draw = () => {
      }

      //ゲームオーバー画面を呼ぶメソッド
      gameover = () => {
        if (hp <= 0) {
          ctx.drawImage(endImage, 0, 0, 800, 500);
        }
      }
      //ゲームクリア画面を呼ぶメソッド
      gameclear = () => {
        if (enemyCharacters.length === 0) {
          ctx.drawImage(clearImage, 0, 0, 800, 500);
        }
      }

    }

    //自機キャラのクラス
    class Character {
      constructor(x, y, hp) {
        this.x = x
        this.y = y
        this.hp = hp
        this.image = new Image();
        this.image.src = "/Users/masuishintarou/Documents/GitHub/Invaders-game/騎士画像.png";
        this.muteki_interval = 0;
        this.image.onload = () => {
          ctx.drawImage(this.image, this.x, this.y, 70, 70)
        }
      }

      //キーを入力されたら自機キャラが動く
      input = event => {
        console.log(event)
        switch (event.code) {
          case "ArrowRight":
            this.x += 20;
            ctx.drawImage(this.image, this.x, this.y, 70, 70)
            break;
          case "ArrowLeft":
            this.x -= 20;
            ctx.drawImage(this.image, this.x, this.y, 70, 70)
            break;
          case "ArrowUp":
            this.y -= 20;
            ctx.drawImage(this.image, this.x, this.y, 70, 70)
            break;
          case "ArrowDown":
            this.y += 20;
            ctx.drawImage(this.image, this.x, this.y, 70, 70)
            break;
          case "Space":
            this.attack();
            break;
          default:
        }
      }

      //体力を減少させる
      damege = () => {
        this.hp -= 10;
      }

      //弾オブジェクトのインスタンスを生成するメソッド　弾を生成する
      attack = () => {
        const bullet = new Bullet(this.x, this.y - 30);
        console.log(bullet);
        game.bullets.push(bullet);
      }
    }



    //敵キャラクラス
    class Enemy {
      constructor(x, y) {
        this.x = x //x座標
        this.y = y //y座標
        this.speedX = 3; //マイフレームx座標を動く速さ
        this.speedY = 2.5;//マイフレームy座標を動く速さ
        this.image = new Image();//敵キャラの画像情報についての変数 ★画像の横と縦を変数か
        this.image.src = "/Users/masuishintarou/Documents/GitHub/Invaders-game/pipo-enemy003.png";
        this.image.onload = () => {
          ctx.drawImage(this.image, this.x, this.y, 70, 70)
        }
      }

      //決まった一定の動きをした結果を描画する
      move = () => {
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.x > 800 || this.x < 0) {
          this.speedX = this.speedX * -1.2;
        }
        if (this.y > 500) {
          this.y = -30;
        }
        ctx.drawImage(this.image, this.x, this.y, 70, 70)
      }
    }



    //自機キャラが攻撃する時に出現する弾のクラス
    class Bullet {
      constructor(x, y) {
        this.x = x
        this.y = y
        this.speedY = -5;
        this.image = new Image();
        this.image.src = "/Users/masuishintarou/Documents/GitHub/Invaders-game/弾丸画像.png";
      }


      //決まった一定の動きをした結果を描画する
      move = () => {
        this.y += this.speedY;
        ctx.drawImage(this.image, this.x, this.y, 30, 30)
      }
    }


    //ゲームクラスからインスタンスを生成し変数gameへ格納　その後初めのinitializeメソッドの実行
    const game = new Game();
    game.initialize();
    game.mainLoop();



  </script>
</body>

</html>